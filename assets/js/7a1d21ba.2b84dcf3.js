"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[396],{5359:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var s=t(4848),i=t(8453);const o={title:"JavaScript",description:"Information on writing Chainless functions using the NodeJS runtime."},a="JavaScript Functions",c={id:"persistent-functions/javascript",title:"JavaScript",description:"Information on writing Chainless functions using the NodeJS runtime.",source:"@site/docs/persistent-functions/javascript.md",sourceDirName:"persistent-functions",slug:"/persistent-functions/javascript",permalink:"/chainless/docs/persistent-functions/javascript",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"JavaScript",description:"Information on writing Chainless functions using the NodeJS runtime."},sidebar:"tutorialSidebar",previous:{title:"Persistent Functions",permalink:"/chainless/docs/persistent-functions"},next:{title:"JVM Functions",permalink:"/chainless/docs/persistent-functions/jvm"}},r={},l=[{value:"What you&#39;ll need",id:"what-youll-need",level:2},{value:"Definition",id:"definition",level:2},{value:"<code>package.json</code>",id:"packagejson",level:3},{value:"Function Code",id:"function-code",level:2},{value:"<code>index.js</code>",id:"indexjs",level:3},{value:"Zip and Upload",id:"zip-and-upload",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"javascript-functions",children:"JavaScript Functions"}),"\n",(0,s.jsx)(e.p,{children:"Persistent Functions can be written in JavaScript or TypeScript using the Node runtime."}),"\n",(0,s.jsxs)(e.p,{children:["Your code files are structured like a normal NPM project, including a ",(0,s.jsx)(e.code,{children:"package.json"})," (and the generated ",(0,s.jsx)(e.code,{children:"package-lock.json"})," and ",(0,s.jsx)(e.code,{children:"node_modules"}),") and ",(0,s.jsx)(e.code,{children:".js"})," files for your implementation.  You should, at minimum, have a ",(0,s.jsx)(e.code,{children:"index.js"})," file which serves as the entry point for your function."]}),"\n",(0,s.jsx)(e.h2,{id:"what-youll-need",children:"What you'll need"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://nodejs.org/en/download/",children:"Node.js"})," version 18.0 or above:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"When installing Node.js, you are recommended to check all checkboxes related to dependencies."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"definition",children:"Definition"}),"\n",(0,s.jsx)(e.h3,{id:"packagejson",children:(0,s.jsx)(e.code,{children:"package.json"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "name": "block-counter",\n  "version": "1.0.0",\n  "description": "Counts the number of blocks processed by blockchain",\n  "main": "index.js",\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "axios": "^1.6.7"\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Feel free to add other dependencies. ",(0,s.jsx)(e.code,{children:"axios"})," is used as an HTTP client. Be sure to run ",(0,s.jsx)(e.code,{children:"npm install"}),"!"]}),"\n",(0,s.jsx)(e.h2,{id:"function-code",children:"Function Code"}),"\n",(0,s.jsx)(e.h3,{id:"indexjs",children:(0,s.jsx)(e.code,{children:"index.js"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"const axios = require('axios');\n\nconst callbackBasePath = process.env.CALLBACK_BASE_URL\nconst nextTaskUrl = `${callbackBasePath}/next`\nconst successTaskUrl = `${callbackBasePath}/success`\nconst errorTaskUrl = `${callbackBasePath}/error`\n\nasync function run() {\n    try {\n        while(true) {\n            console.log(\"Fetching next task\")\n            let taskResponse = await axios.get(nextTaskUrl)\n            if(taskResponse.data == null) break\n            let task = taskResponse.data\n            if(task.taskType === \"init\") {\n                await sendSuccess({})\n            } else if(task.taskType === \"apply\") {\n                let blockWithChain = task.blockWithChain\n                let stateWithChains = task.stateWithChains\n                let state = { ...stateWithChains.state }\n                let chain = blockWithChain.meta.chain;\n                let previousCount = state[chain] ?? 0;\n                state[chain] = previousCount + 1;\n                await sendSuccess(state);\n            }\n        }\n    } catch (e) {\n        await sendError(e)\n    }\n}\n\nfunction sendSuccess(state) {\n    return axios({\n        method: 'post',\n        url: successTaskUrl,\n        data: state\n    })\n}\n\nfunction sendError(e) {\n    return axios({\n        method: 'post',\n        url: errorTaskUrl,\n        data: e\n    })\n}\n\nrun().catch((e) => console.log(`Error ${e}`));\n"})}),"\n",(0,s.jsx)(e.h2,{id:"zip-and-upload",children:"Zip and Upload"}),"\n",(0,s.jsxs)(e.p,{children:["Once your function is written, you can package up the contents of the directory into a ",(0,s.jsx)(e.code,{children:".zip"})," file.  Be sure the ",(0,s.jsx)(e.code,{children:"package.json"})," is at the root of the ",(0,s.jsx)(e.code,{children:".zip"})," file, not in a sub-directory."]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>c});var s=t(6540);const i={},o=s.createContext(i);function a(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);